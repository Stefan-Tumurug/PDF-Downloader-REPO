<Window x:Class="PdfDownloader.Gui.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="PDF Downloader"
        Height="650"
        Width="980"
        WindowStartupLocation="CenterScreen"
        Background="#FFF6F7F9">

    <!--
        UI-only improvements:
        - Card layout
        - App-like styles (buttons, inputs, grid)
        - Keeps the same bindings/commands and ViewModel properties
        - No business logic changes
    -->

    <Window.Resources>

        <!-- ===== Typography ===== -->
        <Style TargetType="TextBlock">
            <Setter Property="Foreground" Value="#FF1F2937"/>
        </Style>

        <Style x:Key="LabelText" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#FF374151"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <Style x:Key="HintText" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#FF6B7280"/>
            <Setter Property="FontSize" Value="12"/>
        </Style>

        <!-- ===== TextBox ===== -->
        <Style TargetType="TextBox">
            <Setter Property="MinHeight" Value="28"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="BorderBrush" Value="#FFD1D5DB"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>

        <!-- ===== CheckBox ===== -->
        <Style TargetType="CheckBox">
            <Setter Property="Foreground" Value="#FF374151"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <!-- ===== Buttons ===== -->
        <Style x:Key="BaseButton" TargetType="Button">
            <Setter Property="MinHeight" Value="30"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#FFD1D5DB"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="Foreground" Value="#FF111827"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>

        <Style x:Key="PrimaryButton" TargetType="Button" BasedOn="{StaticResource BaseButton}">
            <Setter Property="Background" Value="#FF2563EB"/>
            <Setter Property="BorderBrush" Value="#FF2563EB"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>

        <Style x:Key="DangerButton" TargetType="Button" BasedOn="{StaticResource BaseButton}">
            <Setter Property="Background" Value="#FFDC2626"/>
            <Setter Property="BorderBrush" Value="#FFDC2626"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>

        <Style TargetType="Button" BasedOn="{StaticResource BaseButton}">
            <Style.Triggers>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Opacity" Value="0.55"/>
                    <Setter Property="Cursor" Value="Arrow"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- ===== Card container ===== -->
        <Style x:Key="Card" TargetType="Border">
            <Setter Property="CornerRadius" Value="10"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#FFE5E7EB"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="14"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
        </Style>

        <!-- ===== DataGrid styling ===== -->
        <Style TargetType="DataGrid">
            <Setter Property="BorderBrush" Value="#FFE5E7EB"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="RowBackground" Value="White"/>
            <Setter Property="AlternatingRowBackground" Value="#FFF9FAFB"/>
            <Setter Property="GridLinesVisibility" Value="Horizontal"/>
            <Setter Property="HorizontalGridLinesBrush" Value="#FFE5E7EB"/>
            <Setter Property="VerticalGridLinesBrush" Value="#FFE5E7EB"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="CanUserResizeRows" Value="False"/>
            <Setter Property="CanUserReorderColumns" Value="False"/>
            <Setter Property="CanUserSortColumns" Value="True"/>
        </Style>

        <Style TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="#FFF3F4F6"/>
            <Setter Property="Foreground" Value="#FF111827"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="BorderBrush" Value="#FFE5E7EB"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
        </Style>

        <Style TargetType="DataGridCell">
            <Setter Property="Padding" Value="10,6"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>

    </Window.Resources>

    <Grid Margin="14">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- header -->
            <RowDefinition Height="Auto"/>
            <!-- inputs -->
            <RowDefinition Height="Auto"/>
            <!-- actions + progress -->
            <RowDefinition Height="*"/>
            <!-- grid -->
        </Grid.RowDefinitions>

        <!-- =========================
             Header
             ========================= -->
        <Border Grid.Row="0" Style="{StaticResource Card}" Margin="0,0,0,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel>
                    <TextBlock Text="PDF Downloader"
                               FontSize="18"
                               FontWeight="SemiBold"/>

                    <TextBlock Text="Select an Excel file and an output folder. The run stops after the configured number of successful downloads."
                               Margin="0,6,0,0"
                               Style="{StaticResource HintText}"
                               TextWrapping="Wrap"/>
                </StackPanel>

                <TextBlock Grid.Column="1"
                           Text="{Binding Vm.StatusText}"
                           VerticalAlignment="Center"
                           Margin="16,0,0,0"
                           FontWeight="SemiBold"
                           Foreground="#FF2563EB"/>
            </Grid>
        </Border>

        <!-- =========================
             Inputs
             ========================= -->
        <Border Grid.Row="1" Style="{StaticResource Card}" Margin="0,0,0,12">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="120"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="110"/>
                </Grid.ColumnDefinitions>

                <!-- Excel -->
                <TextBlock Grid.Row="0" Grid.Column="0"
                           Text="Excel file"
                           Style="{StaticResource LabelText}"
                           Margin="0,0,10,10"/>

                <TextBox Grid.Row="0" Grid.Column="1"
                         Text="{Binding Vm.XlsxPath, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,0,10,10"/>

                <Button Grid.Row="0" Grid.Column="2"
                        Content="Browse..."
                        Command="{Binding BrowseExcelCommand}"
                        Margin="0,0,0,10"/>

                <!-- Output -->
                <TextBlock Grid.Row="1" Grid.Column="0"
                           Text="Output folder"
                           Style="{StaticResource LabelText}"
                           Margin="0,0,10,10"/>

                <TextBox Grid.Row="1" Grid.Column="1"
                         Text="{Binding Vm.OutputFolder, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,0,10,10"/>

                <Button Grid.Row="1" Grid.Column="2"
                        Content="Browse..."
                        Command="{Binding BrowseOutputCommand}"
                        Margin="0,0,0,10"/>

                <!-- Options -->
                <StackPanel Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="3"
                            Orientation="Horizontal"
                            Margin="0,2,0,0">
                    <TextBlock Text="Download limit:"
                               Style="{StaticResource LabelText}"
                               Margin="0,0,8,0"/>

                    <TextBox Width="80"
                             Text="{Binding Vm.MaxSuccessfulDownloads, UpdateSourceTrigger=PropertyChanged}"/>

                    <CheckBox Content="Overwrite existing files"
                              Margin="16,0,0,0"
                              IsChecked="{Binding Vm.OverwriteExisting}"/>

                    <TextBlock Text="Tip: Keep the limit low to avoid excessive network usage."
                               Style="{StaticResource HintText}"
                               Margin="16,0,0,0"
                               VerticalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- =========================
             Actions + Progress
             ========================= -->
        <Grid Grid.Row="2" Margin="0,0,0,12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Actions + summary -->
            <Border Grid.Column="0" Style="{StaticResource Card}" Padding="14" Margin="0,0,12,0">
                <StackPanel>
                    <StackPanel Orientation="Horizontal">
                        <Button Style="{StaticResource PrimaryButton}"
                                Content="Start"
                                Width="120"
                                Margin="0,0,8,0"
                                Command="{Binding StartCommand}"
                                IsEnabled="{Binding Vm.CanStart}"/>

                        <Button Style="{StaticResource DangerButton}"
                                Content="Cancel"
                                Width="120"
                                Command="{Binding CancelCommand}"
                                IsEnabled="{Binding Vm.CanCancel}"/>
                    </StackPanel>

                    <!-- Summary counters -->
                    <StackPanel Orientation="Horizontal" Margin="0,12,0,0">
                        <TextBlock Margin="0,0,12,0">
                            <Run Text="Downloaded: "/>
                            <Run Text="{Binding Vm.DownloadedCount, Mode=OneWay}"/>
                        </TextBlock>

                        <TextBlock Margin="0,0,12,0">
                            <Run Text="Failed: "/>
                            <Run Text="{Binding Vm.FailedCount, Mode=OneWay}"/>
                        </TextBlock>

                        <TextBlock>
                            <Run Text="Skipped: "/>
                            <Run Text="{Binding Vm.SkippedCount, Mode=OneWay}"/>
                        </TextBlock>
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- Progress -->
            <Border Grid.Column="1" Style="{StaticResource Card}">
                <StackPanel>
                    <TextBlock Text="Progress"
                               FontWeight="SemiBold"
                               Margin="0,0,0,8"/>

                    <ProgressBar Height="16"
                     Minimum="0"
                     Maximum="100"
                     Value="{Binding Vm.ProgressPercent, Mode=OneWay}" />

                    <TextBlock Margin="0,10,0,0"
                               Text="{Binding Vm.ProgressText}"
                               Style="{StaticResource HintText}"
                               TextWrapping="Wrap"/>
                </StackPanel>
            </Border>
        </Grid>

        <!-- =========================
             Results grid
             ========================= -->
        <Border Grid.Row="3" Style="{StaticResource Card}" Padding="0">
            <DataGrid ItemsSource="{Binding Vm.Rows}"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      CanUserAddRows="False">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="BR"
                                        Binding="{Binding BrNum}"
                                        Width="120"/>

                    <DataGridTextColumn Header="Attempted URL"
                                        Binding="{Binding AttemptedUrl}"
                                        Width="*"/>

                    <DataGridTextColumn Header="Status"
                                        Binding="{Binding Status}"
                                        Width="140"/>

                    <DataGridTextColumn Header="Error"
                                        Binding="{Binding Error}"
                                        Width="260"/>
                </DataGrid.Columns>
            </DataGrid>
        </Border>
    </Grid>
</Window>